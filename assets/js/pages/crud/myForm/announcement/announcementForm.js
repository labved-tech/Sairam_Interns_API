/* eslint-disable */
'use strict';

/* Class definition */
const AnnouncementCRUD = (function () {
  const _buttonSpinnerClasses = 'spinner spinner-right spinner-white pr-15';

  /*   Private functions */
  const _createAnnouncementEntriesForm = function () {

    // Getting Document related information
    const createAnnouncementEntriesForm = KTUtil.getById('createAnnouncementEntriesForm');
    const formSubmitButton = KTUtil.getById('announcementEntriesFormSubmit');
    const aeTitle = KTUtil.getById('aeTitle');
    const aeFrom = KTUtil.getById('aeFrom');
    const aePriority = KTUtil.getById('aePriority');
    const aeIsEmailReq = KTUtil.getById('aeIsEmailReq');
    const aeExpires = KTUtil.getById('aeExpires');
    const aeMessage = KTUtil.getById('aeMessage');

    // Initializing 
    $(aeMessage).summernote({
      height: 400,
      tabsize: 2,
    });

    $(aeExpires).select2({
      placeholder: "Select expiry"
    });

    // Return Form
    if (!createAnnouncementEntriesForm) {
      return;
    }

    // Validation
    const fv = FormValidation.formValidation(createAnnouncementEntriesForm, {
      fields: {
        aeTitle: {
          validators: {
            notEmpty: {
              message: 'Title is required',
            },
          },
        },
        aeFrom: {
          validators: {
            notEmpty: {
              message: 'From email address cannot be empty',
            },
          },
        },
        aeExpires: { 
          validators: {
            notEmpty: {
                message: 'Select expiry option',
            },
          },
        }, 
        aePriority: {
          validators: {
            notEmpty: {
              message: 'This field is required',
            },
          },
        },
        aeMessage: {
          validators: {
            callback: {
              message: 'The content is required and cannot be empty',
              callback: function(input) {
                const code = $('[name="aeMessage"]').summernote('code');
                // <p><br></p> is code generated by Summernote for empty content
                return (code !== '' && code !== '<p><br></p>');
              }
            },
          },
        },


      },

      plugins: {
        //Learn more: https://formvalidation.io/guide/plugins
        trigger: new FormValidation.plugins.Trigger(),
        // Bootstrap Framework Integration
        bootstrap: new FormValidation.plugins.Bootstrap(),
        // Validate fields when clicking the Submit button
        submitButton: new FormValidation.plugins.SubmitButton(),
        // Submit the form when all fields are valid
        //defaultSubmit: new FormValidation.plugins.DefaultSubmit(),
      },
    })
      .on('core.form.valid', function () {
        // Show loading state on button
        KTUtil.btnWait(formSubmitButton, _buttonSpinnerClasses, 'Please wait');

        aeIsEmailReq.value = (aeIsEmailReq.value == 'on') ? true:false


        // Accessing Restful API
        axios({
          method: 'post',
          url: `${HOST_URL}/api/v1/announcement/entries`,
          data: {
            title: aeTitle.value,
            message: $('#aeMessage').summernote('code'),   // not working - Summernote WYSIWYG
            from: aeFrom.value,
            isEmailReq: aeIsEmailReq.value,   //if(aeIsEmailReq.value=== 'on') return true
            priority: (aePriority.value) * 1,
            expires: aeExpires.value,
          },

        }).then(function (res) {
          // Return valid JSON
          // Release button
          KTUtil.btnRelease(formSubmitButton);
          console.log(res);

          // TOASTR EXAMPLE

          toastr.options = {
            "closeButton": false,
            "debug": false,
            "newestOnTop": true,
            "progressBar": false,
            "positionClass": "toast-top-right",
            "preventDuplicates": false,
            "onclick": null,
            "showDuration": "300",
            "hideDuration": "1000",
            "timeOut": "5000",
            "extendedTimeOut": "1000",
            "showEasing": "swing",
            "hideEasing": "linear",
            "showMethod": "fadeIn",
            "hideMethod": "fadeOut"
          };

          if (res.data.status == 'success') {
            toastr.success(`${res.data.message}`, `${res.data.status}`)
          } else if (res.data.status == 'error') {
            toastr.error(`${res.data.message}`, `${res.data.status}`)
          }
        });

      })
      .on('core.form.invalid', function () {
        console.log('Something went wrong!!');

      });

  };


  return {
    // public functions
    init: function () {
      _createAnnouncementEntriesForm();
    },
  };
})();

jQuery(document).ready(function () {
  AnnouncementCRUD.init();
});